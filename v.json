FILE="v.json"

new_entry=$(jq -n \
  --arg rom "$rom_name" \
  --arg boot "$boot_img" \
  --arg init "$init_boot" \
  --arg vendor "$vendor_boot" \
  --arg settings "$settings_apk" \
  --arg link "https://github.com/RecSpeed/firmwareextrs/releases/download/auto/boot_img_${rom_name}.zip" \
  '{
    ($rom): {
      boot_img_zip: $boot,
      init_boot_img_zip: $init,
      vendor_boot_img_zip: $vendor,
      app_settings_zip: $settings,
      boot_img_link: $link
    }
  }')

if [ ! -f "$FILE" ]; then
  echo "$new_entry" > "$FILE"
else
  tmpfile=$(mktemp)
  jq -s '.[0] * .[1]' "$FILE" <(echo "$new_entry") > "$tmpfile" && mv "$tmpfile" "$FILE"
fi
